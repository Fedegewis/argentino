<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Buscador</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #resultado { margin-top: 20px; font-weight: bold; color: #b00; }
        input[type="text"] { padding: 8px; width: 300px; }
        button { padding: 8px 12px; }
        small { display:block; margin-top:8px; color:#666; }
    </style>
</head>
<body>
    <h1>Buscar en México</h1>

    <form id="form-buscar">
        <input type="text" id="buscar" placeholder="¿Qué buscas?" maxlength="100">
        <button type="submit">Buscar</button>
    </form>

    <div id="resultado"></div>
    <small>Abre la consola (F12) para ver logs de depuración.</small>

    <script>
        const paginas = [
            "aberturas","abogados","accesorios+para+baño","aceites+vegetales","adiestramiento+de+perros",
            "adopcion+de+mascotas","agencias+de+modelaje","agencias+de+publicidad","aislantes","albaniles",
            "alfombras","alimentos+congelados","alimentos+dieteticos","alimentos+en+conserva",
            "alimentos+para+mascotas","alimentos+veganos","ambulancias","andamios","anticuarios","arquitectos",
            "artes+marciales","articulos+de+electricidad","articulos+de+limpieza","articulos+de+peluqueria",
            "articulos+deportivos","atletismo","autos","autobuses","autoescuelas","autos+chocados","azucar",
            "ballet","balonmano","banos+portatiles","banos+quimicos","barberias","basquet","bazares",
            "bebidas+alcoholicas","bebidas+sin+alcohol","bibliotecas","bicicleterias","billares","bowling",
            "calefaccion+y+ventilacion","camiones","camionetas","carnavales","carnes","carpinteros+de+obra",
            "carros+de+golf","casas+rodantes","caza+y+pesca","centros+educativos","cereales","chocolate",
            "ciclismo","cines","circos","clases+de+idiomas","clubes+deportivos","colchoneria","colegios",
            "comics","concesionarios","conciertos","conejo+mascota","contadores","corseterias",
            "cortinas+y+persianas","cristalerias","cursos","desfiles+de+modas","discotecas",
            "disenadores+graficos","droguerias","educacion+artistica","educacion+especial",
            "educacion+primaria","educacion+privada","educacion+religiosa","educacion+secundaria",
            "electricistas","electrodomesticos","escribanos","escuelas","estetica+corporal","eventos",
            "florerias","gatos+mascota","higiene+personal","iluminacion","imprentas",
            "instrumentos+musicales","jardineria","joyerias","jugueterias","librerias","maquillajes",
            "marroquinerias","muebles","pajarerias","paseadores+de+perros","peceras","peces","peluquerias",
            "peluquerias+de+mascotas","piercings","tatuajes","unas","venta+de+inmuebles","veterinarias"
        ];

        function normalizeInput(q) {
            return (q || "").trim().toLowerCase();
        }

        // Busca coincidencia en el array
        function findPaginaForQuery(query) {
            const q = normalizeInput(query);
            if (!q) return null;
            const plusVariant = q.replace(/\s+/g, "+");
            for (const p of paginas) {
                const pSpace = p.replace(/\+/g, " ").toLowerCase();
                if (p === plusVariant) return p;
                if (pSpace === q) return p;
                if (pSpace.includes(q)) return p;
                if (p.includes(plusVariant)) return p;
            }
            return null;
        }

        // Redirigir probando URL sin y con .html
        async function redirectToExisting(pagina, resultadoElem) {
            const base = "https://fedegewis.github.io/argentino/mexico/";
            const candidatos = [
                `${base}${pagina}`,
                `${base}${pagina}.html`
            ];

            console.log("Probando rutas:", candidatos);

            for (const url of candidatos) {
                try {
                    const resp = await fetch(url, { method: "HEAD" });
                    console.log("HEAD", url, "=>", resp.status);
                    if (resp.ok) {
                        window.location.href = url;
                        return;
                    }
                } catch (err) {
                    console.log("Error al probar:", url, err);
                }
            }

            resultadoElem.textContent = "No se encontró la página para: " + pagina;
        }

        async function handleSearch(query) {
            const resultado = document.getElementById("resultado");
            resultado.textContent = "";

            const pagina = findPaginaForQuery(query);

            if (pagina) {
                // Mostrar la categoría encontrada (con espacios en lugar de +)
                resultado.textContent = "Categoría encontrada: " + pagina.replace(/\+/g, " ");
                await redirectToExisting(pagina, resultado);
            } else {
                resultado.textContent = "No se encontraron resultados para: " + query;
            }
        }

        // Formulario
        const form = document.getElementById("form-buscar");
        const input = document.getElementById("buscar");
        form.addEventListener("submit", function(e) {
            e.preventDefault();
            handleSearch(input.value);
        });

        // Si la URL trae ?b=xxx
        const urlParams = new URLSearchParams(window.location.search);
        const urlQuery = urlParams.get("b");
        if (urlQuery) {
            input.value = urlQuery;
            handleSearch(urlQuery);
        }
    </script>
</body>
</html>
